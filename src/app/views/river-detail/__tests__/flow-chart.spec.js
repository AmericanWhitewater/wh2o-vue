import { createWrapper } from "@/utils";
import FlowChart from "@/app/views/river-detail/components/flow-tab/components/flow-chart/flow-chart.vue";
import { buildChart } from "@/app/views/river-detail/components/flow-tab/components/flow-chart/build-chart.js";

jest.mock(
  "@/app/views/river-detail/components/flow-tab/components/flow-chart/build-chart.js"
);

const mockStore = {
  state: {
    GageMetrics: {
      data: [],
    },
  },
};

const options = {
  mocks: {
    $store: mockStore,
  },
  propsData: {
    gages: [
      {
        rc: 0.4500000000000002,
        epoch: 1614274175.762129,
        time_adjustment: null,
        gauge_reading: 2.75,
        gauge_metric: 8,
        gauge_comment: null,
        delay_update: 0,
        range_comment: null,
        class: "med",
        excluded: false,
        rmin: 2.3,
        rmax: 3.3,
        gauge: {
          name: "PINEY CREEK AT RALEIGH, WV",
          id: "7470",
          source: "usgs",
          source_id: "03185000",
          updates: [
            { metric: { id: "8", name: "Feet Stage" } },
            { metric: { id: "2", name: "Flow" } },
          ],
        },
        updated: 353315.237871,
        last_gauge_reading: 2.75,
        last_gauge_updated: 896,
        gauge_perfect: false,
        adjusted_reach_class: null,
      },
    ],

    ranges: [
      {
        range_min: "R0",
        range_max: "R9",
        min: 2.3,
        max: 3.3,
        time_adjustment: null,
        range_comment: null,
        gauge_perfect: false,
        gauge_estimated: false,
        adjusted_reach_class: null,
        gauge_important: false,
        gauge_metric: 8,
        gauge_id: 7470,
      },
    ],
    timeScales: "week",
    readings: [
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74723,
        reading: "3.0338094915662492",
        updated: "1614028416.00000000",
        data: null,
        id: 32083607455807,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74724,
        reading: "2.9816000175476076",
        updated: "1614049152.00000000",
        data: null,
        id: 32083607458621,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74725,
        reading: "2.9454167187213898",
        updated: "1614071194.66666667",
        data: null,
        id: 32083607461321,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74726,
        reading: "2.921666741371155",
        updated: "1614092784.00000000",
        data: null,
        id: 32083607464021,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74727,
        reading: "2.916956600935563",
        updated: "1614113920.00000000",
        data: null,
        id: 32083607466607,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74728,
        reading: "2.896800079345703",
        updated: "1614135552.00000000",
        data: null,
        id: 32083607469421,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74729,
        reading: "2.866666615009308",
        updated: "1614157594.66666667",
        data: null,
        id: 32083607472121,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74730,
        reading: "2.8445832431316376",
        updated: "1614179184.00000000",
        data: null,
        id: 32083607474821,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74731,
        reading: "2.832173834676328",
        updated: "1614200320.00000000",
        data: null,
        id: 32083607477407,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74732,
        reading: "2.8123999404907227",
        updated: "1614221952.00000000",
        data: null,
        id: 32083607480221,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74733,
        reading: "2.7854166328907013",
        updated: "1614243994.66666667",
        data: null,
        id: 32083607482921,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74734,
        reading: "2.7562499940395355",
        updated: "1614265584.00000000",
        data: null,
        id: 32083607485621,
      },
      {
        data: null,
        gauge_id: "7470",
        id: 0,
        metric: 8,
        nv: 0,
        reading: 2.75,
        updated: 1614274175.762129,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74735,
        reading: "2.733913058819978",
        updated: "1614286720.00000000",
        data: null,
        id: 32083607488207,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74736,
        reading: "2.7133333683013916",
        updated: "1614308464.00000000",
        data: null,
        id: 32083607491021,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74737,
        reading: "2.6891667246818542",
        updated: "1614330394.66666667",
        data: null,
        id: 32083607493721,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74738,
        reading: "2.6654167473316193",
        updated: "1614351984.00000000",
        data: null,
        id: 32083607496421,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74739,
        reading: "2.6534783529198687",
        updated: "1614373120.00000000",
        data: null,
        id: 32083607499007,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74740,
        reading: "2.6716000747680666",
        updated: "1614394752.00000000",
        data: null,
        id: 32083607501821,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74741,
        reading: "2.7475000520547233",
        updated: "1614416794.66666667",
        data: null,
        id: 32083607504521,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74742,
        reading: "3.034999966621399",
        updated: "1614428480.00000000",
        data: null,
        id: 32083607504745,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74743,
        reading: "3.642222245534261",
        updated: "1614465792.00000000",
        data: null,
        id: 32083607509807,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74744,
        reading: "3.7404000091552736",
        updated: "1614481152.00000000",
        data: null,
        id: 32083607512621,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74745,
        reading: "3.8699999809265138",
        updated: "1614496870.40000000",
        data: null,
        id: 32083607513745,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74748,
        reading: "4.7733333269755045",
        updated: "1614572032.00000000",
        data: null,
        id: 32083607523421,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74749,
        reading: "6.160416682561238",
        updated: "1614589594.66666667",
        data: null,
        id: 32083607526121,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74750,
        reading: "7.090833306312561",
        updated: "1614611184.00000000",
        data: null,
        id: 32083607528821,
      },
      {
        gauge_id: 7470,
        metric: 8,
        nv: 74751,
        reading: "7.019999980926514",
        updated: "1614622464.00000000",
        data: null,
        id: 32083607528933,
      },
    ],
    metrics: [
      { name: "Flow", unit: "cfs", format: "%4.0f", id: "2", shortkey: "flow" },
      {
        name: "Feet Stage",
        unit: "ft",
        format: "%3.2f",
        id: "8",
        shortkey: "stage",
      },
      {
        name: "Inches Stage",
        unit: "inches",
        format: "%4.0f",
        id: "15",
        shortkey: "in",
      },
      {
        name: "Percent",
        unit: "%",
        format: "%3.1f",
        id: "14",
        shortkey: "perc",
      },
      {
        name: "Metric Volumentric Flow ",
        unit: "cm/s",
        format: "%3.1f",
        id: "13",
        shortkey: "mflow",
      },
      {
        name: "Meters Stage",
        unit: "m",
        format: "%3.2f",
        id: "12",
        shortkey: "mstag",
      },
      {
        name: "Alt. Flow",
        unit: "cfs",
        format: "%4.0f",
        id: "10",
        shortkey: "bflow",
      },
      {
        name: "Alt. Stage in Feet",
        unit: "ft",
        format: "%3.2f",
        id: "11",
        shortkey: "bstag",
      },
      {
        name: "Temperature",
        unit: "? F",
        format: "%3.0f",
        id: "9",
        shortkey: "temp",
      },
      {
        name: "Precip. in 15m",
        unit: "in/15min",
        format: "%2.2f",
        id: "4",
        shortkey: "pc15m",
      },
      {
        name: "Precip. in 6h",
        unit: "in/6h",
        format: "%2.1f",
        id: "6",
        shortkey: "pc6h",
      },
      {
        name: "Precip. in 12h",
        unit: "in/12h",
        format: "%2.1f",
        id: "3",
        shortkey: "pc12h",
      },
      {
        name: "Precip. in 24h",
        unit: "in/24h",
        format: "%2.1f",
        id: "5",
        shortkey: "pc24h",
      },
      {
        name: "Yearly Precip.",
        unit: "in/yr",
        format: "%3.1f",
        id: "7",
        shortkey: "pccum",
      },
      {
        name: "Status",
        unit: "r.c.",
        format: "%1.1f",
        id: "1",
        shortkey: "corr",
      },
    ],
  },

  stubs: ["canvas"],
};

describe("flow-chart.vue", () => {
  it("it builds on load", async () => {
    const wrapper = createWrapper(FlowChart, options);
    await wrapper.vm.$nextTick();
    expect(buildChart).toBeCalledTimes(1);
  });
});
