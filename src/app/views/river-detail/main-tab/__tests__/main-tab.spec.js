import { createWrapper } from '@/utils'
import MainTab from '../main-tab.vue'

jest.mock('mapbox-gl/dist/mapbox-gl', () => ({
  Map: () => ({})
}))

const reach = { avggradient: 35, id: 378, class: 'IV-V', description: '<p>\n\tGore Canyon is <strong>the</strong> post-season run for advanced intermediates and experts in Colorado. Levels usually run 1000+ CFS July until October.</p>\n<p>\n\tAt prime levels, 1000 to 1200 CFS, this run is a solid Class IV run with two Class IV+&#39;s (Pyrite and Kirshbaum) and two solid Class V&#39;s (Gore Rapid and Tunnel Rapid).</p>\n<p>\n\tFour miles of flatwater begin this dark rock canyon with the train track as your companion.</p>\n<p>\n\tAbove 1200 CFS, creek boats are recommended ... and better bring your water wings!</p>\n<p>\n\tBeware the spiders in the sneak at Gore Rapid.</p>\n<p>\n\tSee&nbsp;<a href="http://community.webshots.com/album/22336729OcjlxAgpnn">Mike Albrecht&#39;s</a> and <a href="http://community.webshots.com/album/20724377XXYevsQslM">Ed Hanson&#39;s</a> photos of Gore Canyon.</p>\n<p>\n\t<strong>Shuttle Directions:</strong> About one mile south of Kremmling head west on Trough Road (1 rd). Take a right 1/2 mile down this road, before crossing the river, to get to the put-in.<br />\n\tThe take-out is about 10 miles further down Trough Road at Pumphouse Campground. There is a small fee at Pumphouse to maintain the facilities.</p>\n<p>\n\tReaches of the Colorado River:<br />\n\t<a href="../../content/River_detail_id_377_">01. Hot Sulphur Springs to Hwy 40 bridge (Byers Canyon)</a> (CO, IV)<br />\n\t<a href="../../content/River_detail_id_378_">02. Gore Canyon</a> (CO, IV-V)<br />\n\t<a href="../../content/River_detail_id_379_">03. Pumphouse campground to Rancho Del Rio (Pumphouse)</a> (CO, III)<br />\n\t<a href="../../content/River_detail_id_380_">04. Hanging Lake Exit 125 (I-70) to Shoshone Power Plant Exit 123 (I-70) (Barrel Springs)</a> (CO, IV-V [V+])<br />\n\t<a href="../../content/River_detail_id_4260_">05. Shoshone Power Plant, Exit 123 (I-70) to Grizzly Creek, Exit 121 (I-70) (Shoshone)</a> (CO, III-IV)<br />\n\t<a href="../../content/River_detail_id_4261_">06. Cameo Dam (Big Sur / Lucky 7)</a> (CO, III)<br />\n\t<a href="../../content/River_detail_id_381_">07. Loma to Westwater (Ruby / Horsethief Canyons)</a> (CO-UT, II)<br />\n\t<a href="../../content/River_detail_id_1840_">08. Westwater to Rose Ranch (Westwater Canyon)</a> (UT, I-IV)<br />\n\t<a href="../../content/River_detail_id_1841_">09. Cisco (Rose Ranch) to Moab (Professor Valley)</a> (UT, I-III)<br />\n\t<a href="../../content/River_detail_id_1842_">10. Moab to Powell Reservoir (Cataract Canyon)</a> (UT, I-IV)<br />\n\t<a href="../../content/River_detail_id_114_">11. Lees Ferry to Lake Mead (Grand Canyon)</a> (AZ, I-V)<br />\n\t<a href="../../content/River_detail_id_3190_">12. Black Canyon</a> (AZ-NV, I)</p>\n', edited: '2019-08-22 00:03:01', length: 9.5, maxgradient: 120, plat: 40.043201446533, plon: -106.39600372315, geom: '-106.396247 40.043659,-106.396372 40.043593,-106.39664 40.043363,-106.397021 40.043158,-106.397641 40.04295,-106.3979 40.042842,-106.398121 40.042569,-106.398527 40.042416,-106.399251 40.042337,-106.400067 40.042301,-106.400772 40.042354,-106.402281 40.042615,-106.403143 40.043154,-106.403655 40.043793,-106.404325 40.044901,-106.404576 40.045517,-106.404751 40.046605,-106.405025 40.047779,-106.405285 40.048282,-106.405475 40.048681,-106.405925 40.049347,-106.406483 40.050003,-106.40716 40.050335,-106.408196 40.050505,-106.409149 40.050511,-106.40992 40.050449,-106.410347 40.050244,-106.41077 40.049855,-106.410988 40.049416,-106.411118 40.048874,-106.410973 40.048422,-106.410555 40.047982,-106.409736 40.047338,-106.408725 40.046696,-106.407985 40.046051,-106.40737 40.045405,-106.406964 40.044947,-106.40676 40.0444,-106.406802 40.043964,-106.407189 40.043497,-106.40737 40.042902,-106.407721 40.042304,-106.408067 40.041507,-106.408293 40.040876,-106.408948 40.039917,-106.409316 40.039616,-106.409689 40.039533,-106.410007 40.03953,-106.410609 40.039566,-106.41136 40.039687,-106.411895 40.039786,-106.412538 40.040109,-106.412835 40.040219,-106.413269 40.040362,-106.414584 40.040869,-106.415765 40.041474,-106.417329 40.042458,-106.418222 40.043127,-106.418977 40.043432,-106.419617 40.043633,-106.420733 40.043838,-106.421919 40.044111,-106.42307 40.044332,-106.425079 40.044377,-106.426687 40.044218,-106.427544 40.043972,-106.428801 40.043826,-106.429544 40.043564,-106.430369 40.043379,-106.431 40.043188,-106.431383 40.04307,-106.431877 40.042828,-106.43245 40.041984,-106.433145 40.041574,-106.433839 40.040851,-106.434643 40.04023,-106.435044 40.039868,-106.435288 40.039612,-106.435474 40.039295,-106.435943 40.038644,-106.43627 40.038047,-106.436479 40.037731,-106.43668 40.037536,-106.43715 40.03726,-106.438165 40.036977,-106.438934 40.036811,-106.439556 40.036724,-106.439871 40.036616,-106.440072 40.036448,-106.440269 40.036131,-106.440477 40.035754,-106.440655 40.035568,-106.440933 40.035329,-106.441174 40.035161,-106.441487 40.034948,-106.441959 40.034732,-106.442128 40.034687,-106.442377 40.034666,-106.442752 40.034688,-106.44307 40.03471,-106.443296 40.034637,-106.44353 40.034477,-106.44382 40.034203,-106.444165 40.033885,-106.444511 40.033628,-106.444802 40.033459,-106.44506 40.033325,-106.445543 40.033066,-106.445856 40.032852,-106.446302 40.032481,-106.446523 40.032216,-106.446731 40.0321,-106.447215 40.031955,-106.447588 40.031889,-106.447984 40.031805,-106.448343 40.031635,-106.448623 40.031466,-106.448969 40.031191,-106.449282 40.030952,-106.449663 40.030747,-106.450348 40.030398,-106.450919 40.030077,-106.451846 40.029359,-106.452506 40.028923,-106.453268 40.028242,-106.453771 40.027843,-106.454136 40.027438,-106.454313 40.027226,-106.454455 40.02698,-106.454572 40.026569,-106.454754 40.026078,-106.454874 40.02585,-106.455099 40.025498,-106.455309 40.02526,-106.455599 40.02503,-106.456013 40.024754,-106.456382 40.024505,-106.456963 40.024088,-106.457603 40.023766,-106.458108 40.023507,-106.458615 40.023326,-106.459366 40.022924,-106.45995 40.022664,-106.460524 40.022413,-106.461158 40.022099,-106.461662 40.021814,-106.461965 40.021662,-106.462099 40.021538,-106.462568 40.021192,-106.463048 40.020828,-106.46336 40.020589,-106.46356 40.020386,-106.463837 40.020095,-106.464203 40.01968,-106.464458 40.019424,-106.464961 40.019069,-106.465335 40.018768,-106.465717 40.018632,-106.4661 40.018514,-106.466731 40.018305,-106.467137 40.018169,-106.467442 40.018139,-106.467963 40.018098,-106.468949 40.018077,-106.469516 40.018043,-106.469913 40.018029,-106.470522 40.017873,-106.471685 40.01737,-106.472416 40.017091,-106.472866 40.016919,-106.473475 40.016763,-106.473793 40.01675,-106.474303 40.016735,-106.474984 40.016796,-106.475393 40.016809,-106.47581 40.01669,-106.476159 40.016546,-106.476769 40.016198,-106.477082 40.015959,-106.477283 40.015808,-106.477552 40.015665,-106.477832 40.015504,-106.478246 40.015237,-106.478782 40.014864,-106.479241 40.014588,-106.479675 40.014207,-106.480119 40.013766,-106.480518 40.013333,-106.480844 40.012919,-106.481141 40.012479,-106.48144 40.012144,-106.481639 40.011915,-106.482209 40.011541,-106.482725 40.011256,-106.483095 40.011059,-106.483354 40.010977,-106.48393 40.010891,-106.484722 40.010794,-106.485205 40.01057,-106.485754 40.010249,-106.486193 40.00986,-106.4865 40.009341,-106.486787 40.008971,-106.487254 40.008547,-106.487741 40.008017,-106.488003 40.00756,-106.488106 40.007062,-106.488118 40.00632,-106.488175 40.005788,-106.488291 40.00542,-106.48834 40.005035,-106.488562 40.003759,-106.488705 40.003313,-106.488826 40.003128,-106.488969 40.002926,-106.489204 40.002792,-106.489576 40.002682,-106.490197 40.002578,-106.4905 40.002435,-106.49061 40.002285,-106.490955 40.00195,-106.491277 40.00164,-106.491623 40.001391,-106.492331 40.001103,-106.492916 40.000904,-106.493797 40.000744,-106.494238 40.000686,-106.495352 40.000532,-106.495779 40.000361,-106.496115 40.000182,-106.496389 39.999987,-106.496934 39.99957,-106.497318 39.999198,-106.497653 39.998887,-106.498025 39.998641,-106.498432 39.998389,-106.498728 39.998216,-106.498931 39.998054,-106.499126 39.997893,-106.499279 39.997716,-106.499452 39.997467,-106.499562 39.997296,-106.499828 39.997062,-106.500108 39.996862,-106.500589 39.996546,-106.501454 39.99622,-106.502174 39.995926,-106.502701 39.995593,-106.503104 39.995229,-106.503589 39.994812,-106.503858 39.994587,-106.503921 39.994333,-106.503917 39.994143,-106.503909 39.993774,-106.503835 39.993522,-106.503748 39.993313,-106.50373 39.993134,-106.504174 39.992147,-106.504451 39.991627,-106.504718 39.991297,-106.505068 39.990997,-106.505476 39.990876,-106.506006 39.990648,-106.507713 39.990362,-106.508501 39.990373,-106.509005 39.99025,-106.509346 39.990079', photo: { id: '878356', post: { user: { uname: 'Cphillips', uid: '150704' } }, image: { uri: { medium: '/photos/archive/medium/878356.jpg', big: '/photos/archive/878356.jpg' } } }, river: 'Colorado', section: '02. Gore Canyon' }

const mockStore = {
  state: {
    riverDetailState: {
      riverDetailData: {
        data: null,
        loading: false,
        error: false
      }
    }
  }
}

const mockRoute = {
  params: {
    id: '123'
  }
}

const options = {
  mocks: {
    $store: mockStore,
    $route: mockRoute
  },
  stubs: ['BetaBox', 'SideBar', 'RapidsSection', 'CommentsSection', 'RiverDescription', 'NwiMap']
}

describe('main-tab.vue', () => {
  it('shows error block when reach does not have geom data', () => {
    const wrapper = createWrapper(MainTab, options)

    expect(wrapper.find('.utility-block-error').exists()).toBe(true)
    expect(wrapper.find('nwimap-stub').exists()).toBe(false)
  })

  it('shows map when reach has geom data', () => {
    mockStore.state.riverDetailState.riverDetailData.data = reach

    const wrapper = createWrapper(MainTab, options)

    expect(wrapper.find('.utility-block-error').exists()).toBe(false)
    expect(wrapper.find('nwimap-stub').exists()).toBe(true)
  })
})
